<!DOCTYPE html>
                <html>
                <head>
                    <title>Using the latest advancements in deep learning to predict stock price movements</title>
                <?php include_once 'Elemental/header.php'; ?><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><br><br><h5> This article is reformatted from originally published at <a href="https://towardsdatascience.com/aifortrading-2edd6fac689d"><strong>TDS(Towards Data Science)</strong></a></h5></br><h5> <a href="https://medium.com/@borisborev?source=post_page-----2edd6fac689d--------------------------------">Author : Boris B</a> </h5></div></div></div></section><section data-bs-version="5.1" class="content4 cid-tt5SM2WLsM" id="content4-2" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="title col-md-12 col-lg-9">
                        <h3 class="mbr-section-title mbr-fonts-style mb-4 display-2">
                            <strong>Using the latest advancements in deep learning to predict stock price movements</h3></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 1100w, https://miro.medium.com/v2/resize:fit:1400/1*h6eC4YRmN1JDbnJO4kd11A.jpeg 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*h6eC4YRmN1JDbnJO4kd11A.jpeg"></picture></div><p class="mbr-description mbr-fonts-style mt-2 align-center display-12 text-muted" style="font-size:12px;">Overview of the complete architecture.</p><br></div></div></div></div></section><section data-bs-version="5.1" class="content7 cid-ttbhFZC4Ql" id="content7-8" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
        <div class="container"><div class="row justify-content-center"><div class="col-12 col-md-9"><blockquote><p class="ff4">Link to the complete notebook: <a href="https://github.com/borisbanushev/stockpredictionai" target="_self">https://github.com/borisbanushev/stockpredictionai</a></p></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">In this notebook I will create a complete process for predicting stock price movements. Follow along and we will achieve some pretty good results. For that purpose we will use a <strong>Generative Adversarial Network</strong> (GAN) with <strong>LSTM</strong>, a type of Recurrent Neural Network, as generator, and a Convolutional Neural Network, <strong>CNN</strong>, as a discriminator. We use LSTM for the obvious reason that we are trying to predict time series data. Why we use GAN and specifically CNN as a discriminator? That is a good question: there are special sections on that later.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We will go into greater details for each step, of course, but the most difficult part is the GAN: very tricky part of successfully training a GAN is getting the right set of hyperparameters. For that reason we will use <strong>Bayesian optimisation </strong>(along with Gaussian processes) and <strong>Deep Reinforcement learning</strong> (DRL) for deciding when and how to change the GAN’s hyper parameters (the exploration vs. exploitation dilemma). In creating the reinforcement learning I will use the most recent advancements in the field, such as <strong>Rainbow</strong> and <strong>PPO</strong>.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We will use a lot of different types of input data. Along with the stock’s historical trading data and technical indicators, we will use the newest advancements in <strong>NLP</strong> (using ‘Bidirectional Embedding Representations from Transformers’, <strong>BERT</strong>, sort of a transfer learning for NLP) to create sentiment analysis (as a source for fundamental analysis), Fourier transforms for extracting overall trend directions, <strong>stacked autoencoders</strong> for identifying other high-level features, <strong>Eigen portfolios</strong> for finding correlated assets, autoregressive integrated moving average (<strong>ARIMA</strong>) for the stock function approximation, and many more, in order to capture as much information, patterns, dependencies, etc, as possible about the stock. As we all know, the more (data) the merrier. Predicting stock price movements is an extremely complex task, so the more we know about the stock (from different perspectives) the higher our changes are.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">For the purpose of creating all neural nets we will use <strong>MXNet</strong> and its high-level API — Gluon, and train them on multiple GPUs.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note</strong>: <em>Although I try to get into details of the math and the mechanisms behind almost all algorithms and techniques, this notebook is not explicitly intended to explain how machine/deep learning, or the stock markets, work. The purpose is rather to show how we can use different techniques and algorithms for the purpose of accurately predicting stock price movements, and to also give rationale behind the reason and usefulness of using each technique at each step.</em></p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">Table of Contents</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#bbae" target="_self">1. Introduction</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#f8df" target="_self">2. The Data</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#9bf2" target="_self">2.1. Correlated assets</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#58e2" target="_self">2.2. Technical indicators</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#e9dd" target="_self">2.3. Fundamental analysis</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#d703" target="_self">2.3.1. Bidirectional Embedding Representations from Transformers — BERT</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#c237" target="_self">2.4. Fourier transforms for trend analysis</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#f039" target="_self">2.5. ARIMA as a feature</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#8528" target="_self">2.6. Statistical checks</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#7682" target="_self">2.6.1. Heteroskedasticity, multicollinearity, serial correlation</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#b21b" target="_self">2.7. Feature Engineering</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#a522" target="_self">2.7.1. Feature importance with XGBoost</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#f982" target="_self">2.8. Extracting high-level features with Stacked Autoencoders</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#72ea" target="_self">2.8.1. Activation function — GELU (Gaussian Error)</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#bbcb" target="_self">3. Generative Adversarial Network (GAN)</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#5ec4" target="_self">3.1. Why GAN for stock market prediction</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#3506" target="_self">3.2. Metropolis-Hastings GAN and Wasserstein GAN</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#1faf" target="_self">3.4. The Generator — One layer RNN</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#fa49" target="_self">3.4.1. LSTM or GRU</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#f83d" target="_self">3.4.2. The LSTM architecture</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#f68b" target="_self">3.4.3. Learning rate scheduler</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#265c" target="_self">3.4.4. How to prevent overfitting and the bias-variance trade-off</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#96f6" target="_self">3.5. The Discriminator — One Dimentional CNN</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#473f" target="_self">4.5.1. Why CNN as a discriminator?</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#dc3e" target="_self">3.5.1. The CNN Architecture</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#4010" target="_self">3.6. Hyperparameters</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#655f" target="_self">4. Hyperparameters optimisation</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#70a3" target="_self">4.1. Reinforcement learning for hyperparameters optimization</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#37cc" target="_self">4.1.1. Reinforcement Learning Theory</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#546a" target="_self">4.1.1.1. Rainbow</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#edc6" target="_self">4.1.1.2. PPO</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#bb62" target="_self">4.1.2. Further work on Reinforcement learning</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#7bae" target="_self">4.2. Bayesian optimization</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#f88a" target="_self">4.2.1. Gaussian process</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#c39d" target="_self">5. The Result</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#d891" target="_self">6. What is next?</a></li><li class="ff3" style="font-size:22px;"><a href="https://medium.com/p/2edd6fac689d#42bb" target="_self">7. Disclaimer</a></li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
            <br>
                <hr class="hr5">
            <br>
            </div>
        </div>
    </div>
</section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">1. Introduction</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Accurately predicting the stock markets is a complex task as there are millions of events and pre-conditions for a particular stock to move in a particular direction. So we need to be able to capture as many of these pre-conditions as possible. <mark>We also need make several important assumptions: 1) markets are not 100% random, 2) history repeats, 3) markets follow people’s rational behavior, and 4) the markets are ‘</mark><mark>perfect</mark><mark>’</mark>. And, please, do read the Disclaimer at the bottom.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We will try to predict the price movements of <strong>Goldman Sachs</strong> (NYSE: GS). For the purpose, we will use the daily closing price from January 1st, 2010 to December 31st, 2018 (seven years for training purposes and two years for validation purposes). <em>We will use the terms ‘Goldman Sachs’ and ‘GS’ interchangeably</em>.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
            <br>
                <hr class="hr5">
            <br>
            </div>
        </div>
    </div>
</section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">2. The Data</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We need to understand what affects whether GS’s stock price will move up or down. It is what people as a whole think. Hence, we need to incorporate as much information (depicting the stock from different aspects and angles) as possible. (We will use daily data — 1,585 days to train the various algorithms (70% of the data we have) and predict the next 680 days (test data). Then we will compare the predicted results with a test (hold-out) data. Each type of data (we will refer to it as <em>feature</em>) is explained in greater detail in later sections, but, as a high-level overview, the features we will use are:</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ol><li class="ff3" style="font-size:22px;"><strong>Correlated assets</strong> — these are other assets (any type, not necessarily stocks, such as commodities, FX, indices, or even fixed income securities). A big company, such as Goldman Sachs, obviously doesn’t ‘live’ in an isolated world — it depends on, and interacts with, many external factors, including its competitors, clients, the global economy, the geo-political situation, fiscal and monetary policies, access to capital, etc. The details are listed later.</li><li class="ff3" style="font-size:22px;"><strong>Technical indicators</strong> — a lot of investors follow technical indicators. We will include the most popular indicators as independent features. Among them — 7 and 21 days moving average, exponential moving average, momentum, Bollinger bands, MACD.</li><li class="ff3" style="font-size:22px;"><strong>Fundamental analysis</strong> — A very important feature indicating whether a stock might move up or down. There are two features that can be used in fundamental analysis: 1) Analysing the company performance using 10-K and 10-Q reports, analysing ROE and P/E, etc (we will not use this), and 2) News — potentially news can indicate upcoming events that can potentially move the stock in certain direction. We will read all daily news for Goldman Sachs and extract whether the total sentiment about Goldman Sachs on that day is positive, neutral, or negative (as a score from 0 to 1). As many investors closely read the news and make investment decisions based (partially of course) on news, there is a somewhat high chance that if, say, the news for Goldman Sachs today are extremely positive the stock will surge tomorrow. <em>One crucial point, we will perform feature importance (meaning how indicative it is for the movement of GS) on absolutely every feature (including this one) later on and decide whether we will use it. More on that later</em>. <br></br> For the purpose of creating accurate sentiment prediction, we will use Neural Language Processing (<strong>NLP</strong>). We will use <strong>BERT</strong> — Google’s recently announced NLP approach for transfer learning for sentiment classification stock news sentiment extraction.</li><li class="ff3" style="font-size:22px;"><strong>Fourier transforms</strong> — Along with the daily closing price, we will create Fourier transforms in order to generalize several long- and short-term trends. Using these transforms we will eliminate a lot of noise (random walks) and create approximations of the real stock movement. Having trend approximations can help the LSTM network pick its prediction trends more accurately.</li><li class="ff3" style="font-size:22px;">Autoregressive Integrated Moving Average (<strong>ARIMA</strong>) — This was one of the most popular techniques for predicting future values of time series data (in the pre-neural networks ages). Let’s add it and see if it comes off as an important predictive feature.</li><li class="ff3" style="font-size:22px;"><strong>Stacked autoencoders</strong> — most of the aforementioned features (fundamental analysis, technical analysis, etc) were found by people after decades of research. But maybe we have missed something. Maybe there are hidden correlations that people cannot comprehend due to the enormous amount of data points, events, assets, charts, etc. With stacked autoencoders (type of neural networks) we can use the power of computers and probably find new types of features that affect stock movements. Even though we will not be able to understand these features in human language, we will use them in the GAN.</li><li class="ff3" style="font-size:22px;"><strong>Deep Unsupervised learning</strong> for anomaly detection in options pricing. We will use one more feature — for every day we will add the price for 90-days call option on Goldman Sachs stock. Options pricing itself combines a lot of data. The price for options contract depends on the future value of the stock (analysts try to also predict the price in order to come up with the most accurate price for the call option). Using deep unsupervised learning (Self-organized Maps) we will try to spot anomalies in every day’s pricing. Anomaly (such as a drastic change in pricing) might indicate an event that might be useful for the LSTM to learn the overall stock pattern.</li></ol></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Next, having so many features, we need to perform a couple of important steps:</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ol><li class="ff3" style="font-size:22px;">Perform statistical checks for the ‘quality’ of the data. If the data we create is flawed, then no matter how sophisticated our algorithms are, the results will not be positive. The checks include making sure the data does not suffer from heteroskedasticity, multicollinearity, or serial correlation.</li><li class="ff3" style="font-size:22px;">Create feature importance. If a feature (e.g. another stock or a technical indicator) has no explanatory power to the stock we want to predict, then there is no need for us to use it in the training of the neural nets. We will using <strong>XGBoost</strong> (eXtreme Gradient Boosting), a type of boosted tree regression algorithms.</li></ol></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">As a final step of our data preparation, we will also create <strong>Eigen portfolios</strong> using Principal Component Analysis (<strong>PCA</strong>) in order to reduce the dimensionality of the features created from the autoencoders.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>print('There are {} number of days in the dataset.'.format(dataset_ex_df.shape[0]))</span><span><strong>output</strong> &gt;&gt;&gt; There are 2265 number of days in the dataset.</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Let’s visualize the stock for the last nine years. The dashed vertical line represents the separation between training and test data.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*eHeqBsFLcfMzDIvyL01-eg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*eHeqBsFLcfMzDIvyL01-eg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*eHeqBsFLcfMzDIvyL01-eg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*eHeqBsFLcfMzDIvyL01-eg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*eHeqBsFLcfMzDIvyL01-eg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*eHeqBsFLcfMzDIvyL01-eg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eHeqBsFLcfMzDIvyL01-eg.png 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*eHeqBsFLcfMzDIvyL01-eg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*eHeqBsFLcfMzDIvyL01-eg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*eHeqBsFLcfMzDIvyL01-eg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*eHeqBsFLcfMzDIvyL01-eg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*eHeqBsFLcfMzDIvyL01-eg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*eHeqBsFLcfMzDIvyL01-eg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*eHeqBsFLcfMzDIvyL01-eg.png 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*eHeqBsFLcfMzDIvyL01-eg.png"></picture></div><p class="mbr-description mbr-fonts-style mt-2 align-center display-12 text-muted" style="font-size:12px;">Goldman Sachs stock price (NYSE:GS)</p><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">2.1. Correlated assets</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">As explained earlier we will use other assets as features, not only GS.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">So what other assets would affect GS’s stock movements? Good understanding of the company, its lines of businesses, competitive landscape, dependencies, suppliers and client type, etc is very important for picking the right set of correlated assets:</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;">First are the <strong>companies</strong> similar to GS. We will add JPMorgan Chase and Morgan Stanley, among others, to the dataset.</li><li class="ff3" style="font-size:22px;">As an investment bank, Goldman Sachs depends on the <strong>global economy</strong>. Bad or volatile economy means no M&As or IPOs, and possibly limited proprietary trading earnings. That is why we will include global economy indices. Also, we will include LIBOR (USD and GBP denominated) rate, as possibly shocks in the economy might be accounted for by analysts to set these rates, and other <strong>FI</strong> securities.</li><li class="ff3" style="font-size:22px;">Daily volatility index (<strong>VIX</strong>) — for the reason described in the previous point.</li><li class="ff3" style="font-size:22px;"><strong>Composite indices</strong> — such as NASDAQ and NYSE (from USA), FTSE100 (UK), Nikkei225 (Japan), Hang Seng and BSE Sensex (APAC) indices.</li><li class="ff3" style="font-size:22px;"><strong>Currencies</strong> — global trade is many times reflected into how currencies move, ergo we’ll use a basket of currencies (such as USDJPY, GBPUSD, etc) as features.</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">Overall, we have 72 other assets in the dataset — daily price for every asset.</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">2.2. Technical indicators</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We already covered what are technical indicators and why we use them so let’s jump straight to the code. We will create technical indicators only for GS.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>""" Function to create the technical indicators """</span><span>def get_technical_indicators(dataset):<br/>    # Create 7 and 21 days Moving Average<br/>    dataset['ma7'] = dataset['price'].rolling(window=7).mean()<br/>    dataset['ma21'] = dataset['price'].rolling(window=21).mean()<br/>    <br/>    # Create MACD<br/>    dataset['26ema'] = pd.ewma(dataset['price'], span=26)<br/>    dataset['12ema'] = pd.ewma(dataset['price'], span=12)<br/>    dataset['MACD'] = (dataset['12ema']-dataset['26ema'])</span><span># Create Bollinger Bands<br/>    dataset['20sd'] = pd.stats.moments.rolling_std(dataset['price'],20)<br/>    dataset['upper_band'] = dataset['ma21'] + (dataset['20sd']*2)<br/>    dataset['lower_band'] = dataset['ma21'] - (dataset['20sd']*2)<br/>    <br/>    # Create Exponential moving average<br/>    dataset['ema'] = dataset['price'].ewm(com=0.5).mean()<br/>    <br/>    # Create Momentum<br/>    dataset['momentum'] = dataset['price']-1<br/>    <br/>    return dataset</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">So we have the technical indicators (including MACD, Bollinger bands, etc) for every trading day. We have in total 12 technical indicators.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Let’s visualise the last 400 days for these indicators.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*TQEcFB7KMrM0x6Dp1l-LEQ.png 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*TQEcFB7KMrM0x6Dp1l-LEQ.png"></picture></div><p class="mbr-description mbr-fonts-style mt-2 align-center display-12 text-muted" style="font-size:12px;">Technical indicators for Goldman Sachs — last 400 days.</p><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">2.3. Fundamental analysis</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">For fundamental analysis we will perform sentiment analysis on all daily news about GS. Using sigmoid at the end, result will be between 0 and 1. The closer the score is to 0 — the more negative the news is (closer to 1 indicates positive sentiment). For each day, we will create the average daily score (as a number between 0 and 1) and add it as a feature.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">2.3.1. Bidirectional Embedding Representations from Transformers — BERT</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">For the purpose of classifying news as positive or negative (or neutral) we will use <a href="https://arxiv.org/abs/1810.04805" target="_self">BERT</a>, which is a pre-trained language representation.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Pre-trained BERT models are already available in MXNet/Gluon. We just need to instantiated them and add two (arbitrary number) <code>Dense</code> layers, going to softmax - the score is from 0 to 1.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>import bert</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><em>Going into the details of BERT and the NLP part is not in the scope of this notebook, but you have interest, do let me know — I will create a new repo only for BERT as it definitely is quite promising when it comes to language processing tasks.</em></p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">2.4. Fourier transforms for trend analysis</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Fourier transforms</strong> take a function and create a series of sine waves (with different amplitudes and frames). When combined, these sine waves approximate the original function. Mathematically speaking, the transforms look like this:</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:54%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 410px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*64AWoIDiBdVJLw5KkkqzOw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*64AWoIDiBdVJLw5KkkqzOw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*64AWoIDiBdVJLw5KkkqzOw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*64AWoIDiBdVJLw5KkkqzOw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*64AWoIDiBdVJLw5KkkqzOw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*64AWoIDiBdVJLw5KkkqzOw.png 1100w, https://miro.medium.com/v2/resize:fit:820/format:webp/1*64AWoIDiBdVJLw5KkkqzOw.png 820w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 410px" srcset="https://miro.medium.com/v2/resize:fit:640/1*64AWoIDiBdVJLw5KkkqzOw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*64AWoIDiBdVJLw5KkkqzOw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*64AWoIDiBdVJLw5KkkqzOw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*64AWoIDiBdVJLw5KkkqzOw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*64AWoIDiBdVJLw5KkkqzOw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*64AWoIDiBdVJLw5KkkqzOw.png 1100w, https://miro.medium.com/v2/resize:fit:820/1*64AWoIDiBdVJLw5KkkqzOw.png 820w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/410/1*64AWoIDiBdVJLw5KkkqzOw.png"></picture></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We will use Fourier transforms to extract global and local trends in the GS stock, and to also denoise it a little. So let’s see how it works.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>""" Code to create the Fuorier trasfrom  """</span><span>data_FT = dataset_ex_df[['Date', 'GS']]<br/>close_fft = np.fft.fft(np.asarray(data_FT['GS'].tolist()))<br/>fft_df = pd.DataFrame({'fft':close_fft})<br/>fft_df['absolute'] = fft_df['fft'].apply(lambda x: np.abs(x))<br/>fft_df['angle'] = fft_df['fft'].apply(lambda x: np.angle(x))<br/>plt.figure(figsize=(14, 7), dpi=100)<br/>fft_list = np.asarray(fft_df['fft'].tolist())<br/>for num_ in [3, 6, 9, 100]:<br/>    fft_list_m10= np.copy(fft_list); fft_list_m10[num_:-num_]=0<br/>    plt.plot(np.fft.ifft(fft_list_m10), label='Fourier transform with {} components'.format(num_))<br/>plt.plot(data_FT['GS'],  label='Real')<br/>plt.xlabel('Days')<br/>plt.ylabel('USD')<br/>plt.title('Figure 3: Goldman Sachs (close) stock prices &amp; Fourier transforms')<br/>plt.legend()<br/>plt.show()</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*UTWq-m6nsWp4NrlP47NGhw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*UTWq-m6nsWp4NrlP47NGhw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*UTWq-m6nsWp4NrlP47NGhw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*UTWq-m6nsWp4NrlP47NGhw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*UTWq-m6nsWp4NrlP47NGhw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*UTWq-m6nsWp4NrlP47NGhw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UTWq-m6nsWp4NrlP47NGhw.png 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*UTWq-m6nsWp4NrlP47NGhw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*UTWq-m6nsWp4NrlP47NGhw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*UTWq-m6nsWp4NrlP47NGhw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*UTWq-m6nsWp4NrlP47NGhw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*UTWq-m6nsWp4NrlP47NGhw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*UTWq-m6nsWp4NrlP47NGhw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*UTWq-m6nsWp4NrlP47NGhw.png 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*UTWq-m6nsWp4NrlP47NGhw.png"></picture></div><p class="mbr-description mbr-fonts-style mt-2 align-center display-12 text-muted" style="font-size:12px;">Figure 3: Fourier transform of Goldman Sachs Stock</p><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">As you see in Figure 3 the more components from the Fourier transform we use the closer the approximation function is to the real stock price (the 100 components transform is almost identical to the original function — the red and the purple lines almost overlap). We use Fourier transforms for the purpose of extracting long- and short-term trends so we will use the transforms with 3, 6, and 9 components. You can infer that the transform with 3 components serves as the long term trend.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Another technique used to denoise data is called <strong>wavelets</strong>. Wavelets and Fourier transform gave similar results so we will only use Fourier transforms.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">2.5. ARIMA as a feature</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>ARIMA</strong> is a technique for predicting time series data. We will show how to use it, and althouth ARIMA will not serve as our final prediction, we will use it as a technique to denoise the stock a little and to (possibly) extract some new patters or features.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*sp4wrN9u3XkMCT5r3oaNQA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*sp4wrN9u3XkMCT5r3oaNQA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*sp4wrN9u3XkMCT5r3oaNQA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*sp4wrN9u3XkMCT5r3oaNQA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*sp4wrN9u3XkMCT5r3oaNQA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*sp4wrN9u3XkMCT5r3oaNQA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sp4wrN9u3XkMCT5r3oaNQA.png 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*sp4wrN9u3XkMCT5r3oaNQA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*sp4wrN9u3XkMCT5r3oaNQA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*sp4wrN9u3XkMCT5r3oaNQA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*sp4wrN9u3XkMCT5r3oaNQA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*sp4wrN9u3XkMCT5r3oaNQA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*sp4wrN9u3XkMCT5r3oaNQA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*sp4wrN9u3XkMCT5r3oaNQA.png 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*sp4wrN9u3XkMCT5r3oaNQA.png"></picture></div><p class="mbr-description mbr-fonts-style mt-2 align-center display-12 text-muted" style="font-size:12px;">ARIMA on Goldman Sachs stock</p><br></div></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>error = mean_squared_error(test, predictions)<br/>print('Test MSE: %.3f' % error)</span><span><strong>output</strong> &gt;&gt;&gt; Test MSE: 10.151</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">As we can see from Figure 5 ARIMA gives a very good approximation of the real stock price. We will use the predicted price through ARIMA as an input feature into the LSTM because, as we mentioned before, we want to capture as many features and patterns about Goldman Sachs as possible. We go test MSE (mean squared error) of 10.151, which by itself is not a bad result (considering we do have a lot of test data), but still, we will only use it as a feature in the LSTM.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">2.6. Statistical checks</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Ensuring that the data has good quality is very important for our models. In order to make sure our data is suitable we will perform a couple of simple checks in order to ensure that the results we achieve and observe are indeed real, rather than compromised due to the fact that the underlying data distribution suffers from fundamental errors.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">2.6.1. Heteroskedasticity, multicollinearity, serial correlation</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;"><strong>Conditional Heteroskedasticity</strong> occurs when the error terms (the difference between a predicted value by a regression and the real value) are dependent on the data — for example, the error terms grow when the data point (along the x-axis) grow.</li><li class="ff3" style="font-size:22px;"><strong>Multicollinearity</strong> is when error terms (also called residuals) depend on each other.</li><li class="ff3" style="font-size:22px;"><strong>Serial correlation</strong> is when one data (feature) is a formula (or completely depends) of another feature.</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We will not go into the code here as it is straightforward and our focus is more on the deep learning parts, <strong>but the data is qualitative</strong>.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">2.7. Feature Engineering</h4></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>print('Total dataset has {} samples, and {} features.'.format(dataset_total_df.shape[0],                                                          dataset_total_df.shape[1]))</span><span><strong>output</strong> &gt;&gt;&gt; Total dataset has 2265 samples, and 112 features.</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">So, after adding all types of data (the correlated assets, technical indicators, fundamental analysis, Fourier, and Arima) we have a total of 112 features for the 2,265 days (as mentioned before, however, only 1,585 days are for training data).</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We will also have some more features generated from the autoencoders.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">2.7.1. Feature importance with XGBoost</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Having so many features we have to consider whether all of them are really indicative of the direction GS stock will take. For example, we included USD denominated LIBOR rates in the dataset because we think that changes in LIBOR might indicate changes in the economy, that, in turn, might indicate changes in the GS’s stock behavior. But we need to test. There are many ways to test feature importance, but the one we will apply uses XGBoost, because it gives one of the best results in both classification and regression problems.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Since the features dataset is quite large, for the purpose of the presentation here we’ll use only the technical indicators. During the real features importance testing all selected features proved somewhat important so we won’t exclude anything when training the GAN.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>regressor = xgb.XGBRegressor(gamma=0.0,n_estimators=150,base_score=0.7,colsample_bytree=1,learning_rate=0.05)</span><span>xgbModel = regressor.fit(X_train_FI,y_train_FI, eval_set = [(X_train_FI, y_train_FI), (X_test_FI, y_test_FI)], verbose=False)</span><span>fig = plt.figure(figsize=(8,8))<br/>plt.xticks(rotation='vertical')<br/>plt.bar([i for i in range(len(xgbModel.feature_importances_))], xgbModel.feature_importances_.tolist(), tick_label=X_test_FI.columns)<br/>plt.title('Figure 6: Feature importance of the technical indicators.')<br/>plt.show()</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:66%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 493px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*rWs7xnMkjm7V6R7v5QhstA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*rWs7xnMkjm7V6R7v5QhstA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*rWs7xnMkjm7V6R7v5QhstA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*rWs7xnMkjm7V6R7v5QhstA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*rWs7xnMkjm7V6R7v5QhstA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*rWs7xnMkjm7V6R7v5QhstA.png 1100w, https://miro.medium.com/v2/resize:fit:986/format:webp/1*rWs7xnMkjm7V6R7v5QhstA.png 986w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 493px" srcset="https://miro.medium.com/v2/resize:fit:640/1*rWs7xnMkjm7V6R7v5QhstA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*rWs7xnMkjm7V6R7v5QhstA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*rWs7xnMkjm7V6R7v5QhstA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*rWs7xnMkjm7V6R7v5QhstA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*rWs7xnMkjm7V6R7v5QhstA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*rWs7xnMkjm7V6R7v5QhstA.png 1100w, https://miro.medium.com/v2/resize:fit:986/1*rWs7xnMkjm7V6R7v5QhstA.png 986w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/493/1*rWs7xnMkjm7V6R7v5QhstA.png"></picture></div><p class="mbr-description mbr-fonts-style mt-2 align-center display-12 text-muted" style="font-size:12px;">Feature importance using XGBoost</p><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Not surprisingly (for those with experience in stock trading) that MA7, MACD, and BB are among the important features.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">I followed the same logic for performing feature importance over the whole dataset — just the training took longer and results were a little more difficult to read, as compared with just a handful of features.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">2.8. Extracting high-level features with Stacked Autoencoders</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Before we proceed to the autoencoders, we’ll explore an alternative activation function.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">2.8.1. Activation function — GELU (Gaussian Error)</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>GELU</strong> — Gaussian Error Linear Unites was recently proposed — <a href="https://arxiv.org/pdf/1606.08415.pdf" target="_self">link</a>. In the paper the authors show several instances in which neural networks using GELU outperform networks using ReLU as an activation. <code>gelu</code> is also used in <strong>BERT</strong>, the NLP approach we used for news sentiment analysis.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We will use GELU for the autoencoders.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note</strong>: The cell below shows the logic behind the math of GELU. It is not the actual implementation as an activation function. I had to implement GELU inside MXNet. If you follow the code and change <code>act_type='relu'</code> to <code>act_type='gelu'</code> it will not work, unless you change the implementation of MXNet. Make a pull request on the whole project to access the MXNet implementation of GELU.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Let’s visualize <code>GELU</code>, <code>ReLU</code>, and <code>LeakyReLU</code> (the last one is mainly used in GANs - we also use it).</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>def gelu(x):<br/>    return 0.5 * x * (1 + math.tanh(math.sqrt(2 / math.pi) * (x + 0.044715 * math.pow(x, 3))))</span><span>def relu(x):<br/>    return max(x, 0)<br/>def lrelu(x):<br/>    return max(0.01*x, x)</span><span>plt.figure(figsize=(15, 5))<br/>plt.subplots_adjust(left=None, bottom=None, right=None, top=None, wspace=.5, hspace=None)</span><span>ranges_ = (-10, 3, .25)</span><span>plt.subplot(1, 2, 1)<br/>plt.plot([i for i in np.arange(*ranges_)], [relu(i) for i in np.arange(*ranges_)], label='ReLU', marker='.')<br/>plt.plot([i for i in np.arange(*ranges_)], [gelu(i) for i in np.arange(*ranges_)], label='GELU')<br/>plt.hlines(0, -10, 3, colors='gray', linestyles='--', label='0')<br/>plt.title('Figure 7: GELU as an activation function for autoencoders')<br/>plt.ylabel('f(x) for GELU and ReLU')<br/>plt.xlabel('x')<br/>plt.legend()</span><span>plt.subplot(1, 2, 2)<br/>plt.plot([i for i in np.arange(*ranges_)], [lrelu(i) for i in np.arange(*ranges_)], label='Leaky ReLU')<br/>plt.hlines(0, -10, 3, colors='gray', linestyles='--', label='0')<br/>plt.ylabel('f(x) for Leaky ReLU')<br/>plt.xlabel('x')<br/>plt.title('Figure 8: LeakyReLU')<br/>plt.legend()</span><span>plt.show()</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*XAJdlKP_tHY6dWuTnKc6lg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*XAJdlKP_tHY6dWuTnKc6lg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*XAJdlKP_tHY6dWuTnKc6lg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*XAJdlKP_tHY6dWuTnKc6lg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*XAJdlKP_tHY6dWuTnKc6lg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*XAJdlKP_tHY6dWuTnKc6lg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XAJdlKP_tHY6dWuTnKc6lg.png 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*XAJdlKP_tHY6dWuTnKc6lg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*XAJdlKP_tHY6dWuTnKc6lg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*XAJdlKP_tHY6dWuTnKc6lg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*XAJdlKP_tHY6dWuTnKc6lg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*XAJdlKP_tHY6dWuTnKc6lg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*XAJdlKP_tHY6dWuTnKc6lg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*XAJdlKP_tHY6dWuTnKc6lg.png 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*XAJdlKP_tHY6dWuTnKc6lg.png"></picture></div><p class="mbr-description mbr-fonts-style mt-2 align-center display-12 text-muted" style="font-size:12px;">Comparison of GELU, ReLU, and LeakyReLU</p><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note</strong>: In future versions of this notebook I will experiment using <strong>U-Net</strong> (<a href="https://arxiv.org/abs/1505.04597" target="_self">link</a>), and try to utilize the convolutional layer and extract (and create) even more features about the stock’s underlying movement patterns. For now, we will just use a simple autoencoder made only from <code>Dense</code> layers.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Ok,<strong> back to the autoencoders</strong>, depicted below (the image is only schematic, it doesn’t represent the real number of layers, units, etc.)</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note</strong>: One thing that I will explore in a later version is removing the last layer in the decoder. Normally, in autoencoders the number of encoders == number of decoders. We want, however, to extract higher level features (rather than creating the same input), so we can skip the last layer in the decoder. We achieve this creating the encoder and decoder with the same number of layers during the training, but when we create the output we use the layer next to the only one as it would contain the higher level features.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:57%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 428px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 1100w, https://miro.medium.com/v2/resize:fit:856/format:webp/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 856w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 428px" srcset="https://miro.medium.com/v2/resize:fit:640/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 1100w, https://miro.medium.com/v2/resize:fit:856/1*-9iJNftM1g9eYksBNNTLyQ.jpeg 856w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/428/1*-9iJNftM1g9eYksBNNTLyQ.jpeg"></picture></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content7 cid-ttbhFZC4Ql" id="content7-8" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
        <div class="container"><div class="row justify-content-center"><div class="col-12 col-md-9"><blockquote><p class="ff4">The full code for the autoencoders is available in the accompanying Github — link at top.</p></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We created 112 more features from the autoencoder. As we want to only have high level features (overall patterns) we will create an Eigen portfolio on the newly created 112 features using Principal Component Analysis (PCA). This will reduce the dimension (number of columns) of the data. The descriptive capability of the Eigen portfolio will be the same as the original 112 features.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note</strong> Once again, this is purely experimental. I am not 100% sure the described logic will hold. As everything else in AI and deep learning, this is art and needs experiments.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
            <br>
                <hr class="hr5">
            <br>
            </div>
        </div>
    </div>
</section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">3. Generative Adversarial Network (GAN)</h4></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 1100w, https://miro.medium.com/v2/resize:fit:1400/1*hN0QKvuY4n07jxQCwRSmpg.jpeg 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*hN0QKvuY4n07jxQCwRSmpg.jpeg"></picture></div><p class="mbr-description mbr-fonts-style mt-2 align-center display-12 text-muted" style="font-size:12px;">Architecture of GANs</p><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">How GANs work?</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">As mentioned before, the purpose of this notebook is not to explain in detail the math behind deep learning but to show its applications. Of course, thorough and very solid understanding from the fundamentals down to the smallest details, in my opinion, is extremely imperative. Hence, we will try to balance and give a high-level overview of how GANs work in order for the reader to fully understand the rationale behind using GANs in predicting stock price movements. Feel free to skip this and the next section if you are experienced with GANs (and do check section <a href="http://localhost:8888/lab?#wgan" target="_self">4.2.</a>).</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">A GAN network consists of two models — a <strong>Generator</strong> (G) and <strong>Discriminator</strong> (D). The steps in training a GAN are:</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ol><li class="ff3" style="font-size:22px;">The Generator is, using random data (noise denoted <em>z</em>), trying to ‘generate’ data indistinguishable of, or extremely close to, the real data. Its purpose is to learn the distribution of the real data.</li><li class="ff3" style="font-size:22px;">Randomly, real or generated data is fitted into the Discriminator, which acts as a classifier and tries to understand whether the data is coming from the Generator or is the real data. D estimates the (distributions) probabilities of the incoming sample to the real dataset. (<em>more info on comparing two distributions in section 3.2. below</em>).</li><li class="ff3" style="font-size:22px;">Then, the losses from G and D are combined and propagated back through the generator. Ergo, the generator’s loss depends on both the generator and the discriminator. This is the step that helps the Generator learn about the real data distribution. If the generator doesn’t do a good job at generating a realistic data (having the same distribution), the Discriminator’s work will be very easy to distinguish generated from real data sets. Hence, the Discriminator’s loss will be very small. Small discriminator loss will result in bigger generator loss (<em>see the equation below for </em>L(D,G)). This makes creating the discriminator a bit tricky, because too good of a discriminator will always result in a huge generator loss, making the generator unable to learn.</li><li class="ff3" style="font-size:22px;">The process goes on until the Discriminator can no longer distinguish generated from real data.</li></ol></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">When combined together, D and G as sort of playing a <em>minmax</em> game (the Generator is trying to <em>fool</em> the Discriminator making it increase the probability for on fake examples, i.e. minimize 𝔼z∼pz(z)[log(1−D(G(z)))]. The Discriminator wants to separate the data coming from the Generator, D(G(z)), by maximizing 𝔼x∼pr(x)[logD(x)]. Having separated loss functions, however, it is not clear how both can converge together (that is why we use some advancements over the plain GANs, such as Wasserstein GAN). Overall, the combined loss function looks like:</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*TqzF5d6xFvo6IJMOdBBtnA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*TqzF5d6xFvo6IJMOdBBtnA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*TqzF5d6xFvo6IJMOdBBtnA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*TqzF5d6xFvo6IJMOdBBtnA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*TqzF5d6xFvo6IJMOdBBtnA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*TqzF5d6xFvo6IJMOdBBtnA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TqzF5d6xFvo6IJMOdBBtnA.png 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*TqzF5d6xFvo6IJMOdBBtnA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*TqzF5d6xFvo6IJMOdBBtnA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*TqzF5d6xFvo6IJMOdBBtnA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*TqzF5d6xFvo6IJMOdBBtnA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*TqzF5d6xFvo6IJMOdBBtnA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*TqzF5d6xFvo6IJMOdBBtnA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*TqzF5d6xFvo6IJMOdBBtnA.png 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*TqzF5d6xFvo6IJMOdBBtnA.png"></picture></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note</strong>: Really useful tips for training GANs can be found <a href="https://github.com/soumith/ganhacks" target="_self">here</a>.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note</strong>: I will not include the complete code behind the <strong>GAN</strong> and the <strong>Reinforcement learning</strong> parts in this notebook — only the results from the execution (the cell outputs) will be shown. Make a pull request or contact me for the code.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">3.1. Why GAN for stock market prediction</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Generative Adversarial Networks</strong> (GAN) have been recently used mainly in creating realistic images, paintings, and video clips. There aren’t many applications of GANs being used for predicting time-series data as in our case. The main idea, however, should be same — we want to predict future stock movements. In the future, the pattern and behavior of GS’s stock should be more or less the same (unless it starts operating in a totally different way, or the economy drastically changes). Hence, we want to ‘generate’ data for the future that will have similar (not absolutely the same, of course) distribution as the one we already have — the historical trading data. So, in theory, it should work.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">In our case, we will use <strong>LSTM</strong> as a time-series generator, and <strong>CNN</strong> as a discriminator.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">3.2. Metropolis-Hastings GAN and Wasserstein GAN</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note:</strong> <em>The next couple of sections assume some experience with GANs.</em></p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">I. Metropolis-Hastings GAN</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">A recent improvement over the traditional GANs came out from Uber’s engineering team and is called <strong>Metropolis-Hastings GAN</strong> (MHGAN). The idea behind Uber’s approach is (as they state it) somewhat similar to another approach created by Google and University of California, Berkeley called <strong>Discriminator Rejection Sampling</strong> (<a href="https://arxiv.org/pdf/1810.06758.pdf" target="_self">DRS</a>). Basically, when we train GAN we use the Discriminator (D) for the sole purpose of better training the Generator (G). Often, after training the GAN we do not use the D any more. MHGAN and DRS, however, try to use D in order to choose samples generated by G that are close to the real data distribution (slight difference between is that MHGAN uses Markov Chain Monte Carlo (<strong>MCMC</strong>) for sampling).</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">MHGAN takes <strong>K</strong> samples generated from the G (created from independent noise inputs to the G — z0 to zK in the figure below). Then it sequentially runs through the <strong>K</strong> outputs (x′0 to x′K) and following an acceptance rule (created from the Discriminator) decides whether to accept the current sample or keep the last accepted one. The last kept output is the one considered the real output of G.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note</strong>: MHGAN is originally implemented by Uber in pytorch. I only transferred it into MXNet/Gluon.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">Note: I will also upload it into Github sometime soon.</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Figure 10: Visual representation of MHGAN (from the original <a href="https://eng.uber.com/mh-gan/?amp" target="_self">Uber post</a>).</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*0iif-P3BGvCfDlsziH5xcg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*0iif-P3BGvCfDlsziH5xcg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*0iif-P3BGvCfDlsziH5xcg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*0iif-P3BGvCfDlsziH5xcg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*0iif-P3BGvCfDlsziH5xcg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*0iif-P3BGvCfDlsziH5xcg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0iif-P3BGvCfDlsziH5xcg.png 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*0iif-P3BGvCfDlsziH5xcg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*0iif-P3BGvCfDlsziH5xcg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*0iif-P3BGvCfDlsziH5xcg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*0iif-P3BGvCfDlsziH5xcg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*0iif-P3BGvCfDlsziH5xcg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*0iif-P3BGvCfDlsziH5xcg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*0iif-P3BGvCfDlsziH5xcg.png 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*0iif-P3BGvCfDlsziH5xcg.png"></picture></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">II. Wasserstein GAN</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Training GANs is quite difficult. Models may never converge and mode collapse can easily happen. We will use a modification of GAN called <strong>Wasserstein</strong> GAN — <a href="https://arxiv.org/pdf/1701.07875.pdf" target="_self">WGAN</a>.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Again, we will not go into details, but the most notable points to make are:</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;">As we know the main goal behind GANs is for the Generator to start transforming random noise into some given data that we want to mimic. Ergo, the idea of comparing the similarity between two distributions is very imperative in GANs. The two most widely used such metrics are:</li><li class="ff3" style="font-size:22px;"><strong>KL divergence</strong> (Kullback–Leibler) — DKL(p‖q)=∫xp(x)logp(x)q(x)dx. DKL is zero when p(x) is equal to q(x),</li><li class="ff3" style="font-size:22px;"><strong>JS Divergence</strong> (Jensen–Shannon). JS divergence is bounded by 0 and 1, and, unlike KL divergence, is symmetric and smoother. Significant success in GAN training was achieved when the loss was switched from <strong>KL</strong> to <strong>JS</strong> divergence.</li><li class="ff3" style="font-size:22px;">WGAN uses <strong>Wasserstein distance</strong>, W(pr,pg)=1Ksup‖f‖L≤K𝔼x∼pr[f(x)]−𝔼x∼pg[f(x)] (where sup stands for <em>supremum</em>), as a loss function (also called Earth Mover’s distance, because it normally is interpreted as moving one pile of, say, sand to another one, both piles having different probability distributions, using minimum energy during the transformation). Compared to KL and JS divergences, Wasserstein metric gives a smooth measure (without sudden jumps in divergence). This makes it much more suitable for creating a stable learning process during the gradient descent.</li><li class="ff3" style="font-size:22px;">Also, compared to <strong>KL</strong> and <strong>JS</strong>, Wasserstein distance is differentiable nearly everywhere. As we know, during backpropagation, we differentiate the loss function in order to create the gradients, which in turn update the weights. Therefore, having a differentiable loss function is quite important.</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">Hands down, this was the toughest part of this notebook. Mixing WGAN and MHGAN took me three days.</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">3.4. The Generator — One layer RNN</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">3.4.1. LSTM or GRU</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">As mentioned before, the generator is a LSTM network a type of Recurrent Neural Network (RNN). RNNs are used for time-series data because they keep track of all previous data points and can capture patterns developing through time. Due to their nature, RNNs many time suffer from <em>vanishing gradient</em> — that is, the changes the weights receive during training become so small, that they don’t change, making the network unable to converge to a minimal loss (The opposite problem can also be observed at times — when gradients become too big. This is called <em>gradient exploding</em>, but the solution to this is quite simple — clip gradients if they start exceeding some constant number, i.e. gradient clipping). Two modifications tackle this problem — Gated Recurrent Unit (<strong>GRU</strong>) and Long-Short Term Memory (<strong>LSTM</strong>). The biggest differences between the two are: 1) GRU has 2 gates (update and reset) and LSTM has 4 (update, input, forget, and output), 2) LSTM maintains an internal memory state, while GRU doesn’t, and 3) LSTM applies a nonlinearity (sigmoid) before the output gate, GRU doesn’t.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">In most cases, LSTM and GRU give similar results in terms of accuracy but GRU is much less computational intensive, as GRU has much fewer trainable params. LSTMs, however, and much more used.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Strictly speaking, the math behind the LSTM cell (the gates) is:</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:69%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 514px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*DUeR85B1raizYc_heyeRRA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*DUeR85B1raizYc_heyeRRA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*DUeR85B1raizYc_heyeRRA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*DUeR85B1raizYc_heyeRRA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*DUeR85B1raizYc_heyeRRA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*DUeR85B1raizYc_heyeRRA.png 1100w, https://miro.medium.com/v2/resize:fit:1028/format:webp/1*DUeR85B1raizYc_heyeRRA.png 1028w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 514px" srcset="https://miro.medium.com/v2/resize:fit:640/1*DUeR85B1raizYc_heyeRRA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*DUeR85B1raizYc_heyeRRA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*DUeR85B1raizYc_heyeRRA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*DUeR85B1raizYc_heyeRRA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*DUeR85B1raizYc_heyeRRA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*DUeR85B1raizYc_heyeRRA.png 1100w, https://miro.medium.com/v2/resize:fit:1028/1*DUeR85B1raizYc_heyeRRA.png 1028w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/514/1*DUeR85B1raizYc_heyeRRA.png"></picture></div><p class="mbr-description mbr-fonts-style mt-2 align-center display-12 text-muted" style="font-size:12px;">The math behind the LSTM cell</p><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">where ⊙is an element-wise multiplication operator, and, for all x=[x1,x2,…,xk]⊤∈R^k the two activation functions:,</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*nyZL1-UP-AZQ6vNXRi34kQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*nyZL1-UP-AZQ6vNXRi34kQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*nyZL1-UP-AZQ6vNXRi34kQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*nyZL1-UP-AZQ6vNXRi34kQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*nyZL1-UP-AZQ6vNXRi34kQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*nyZL1-UP-AZQ6vNXRi34kQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nyZL1-UP-AZQ6vNXRi34kQ.png 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*nyZL1-UP-AZQ6vNXRi34kQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*nyZL1-UP-AZQ6vNXRi34kQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*nyZL1-UP-AZQ6vNXRi34kQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*nyZL1-UP-AZQ6vNXRi34kQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*nyZL1-UP-AZQ6vNXRi34kQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*nyZL1-UP-AZQ6vNXRi34kQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*nyZL1-UP-AZQ6vNXRi34kQ.png 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*nyZL1-UP-AZQ6vNXRi34kQ.png"></picture></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">3.4.2. The LSTM architecture</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">The LSTM architecture is very simple — one <code>LSTM</code> layer with 112 input units (as we have 112 features in the dataset) and 500 hidden units, and one <code>Dense</code> layer with 1 output - the price for every day. The initializer is Xavier and we will use L1 loss (which is mean absolute error loss with <strong>L1</strong> regularization - see section 3.4.5. for more info on regularization).</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note</strong> — In the code you can see we use <code>Adam</code> (with <code>learning rate</code> of .01) as an optimizer. Don't pay too much attention on that now - there is a section specially dedicated to explain what hyperparameters we use (learning rate is excluded as we have learning rate scheduler - section 3.4.3.) and how we optimize these hyperparameters - section 3.6.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>gan_num_features = dataset_total_df.shape[1]<br/>sequence_length = 17</span><span>class RNNModel(gluon.Block):<br/>    def __init__(self, num_embed, num_hidden, num_layers, bidirectional=False, sequence_length=sequence_length, **kwargs):<br/>        super(RNNModel, self).__init__(**kwargs)<br/>        self.num_hidden = num_hidden<br/>        with self.name_scope():<br/>            self.rnn = rnn.LSTM(num_hidden, num_layers, input_size=num_embed, bidirectional=bidirectional, layout='TNC')<br/>            self.decoder = nn.Dense(1, in_units=num_hidden)<br/>    <br/>    def forward(self, inputs, hidden):<br/>        output, hidden = self.rnn(inputs, hidden)<br/>        decoded = self.decoder(output.reshape((-1,self.num_hidden)))<br/>        return decoded, hidden<br/>    <br/>    def begin_state(self, *args, **kwargs):<br/>        return self.rnn.begin_state(*args, **kwargs)<br/>    <br/>lstm_model = RNNModel(num_embed=gan_num_features, num_hidden=500, num_layers=1)<br/>lstm_model.collect_params().initialize(mx.init.Xavier(), ctx=mx.cpu())<br/>trainer = gluon.Trainer(lstm_model.collect_params(), 'adam', {'learning_rate': .01})<br/>loss = gluon.loss.L1Loss()</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We will use 500 neurons in the LSTM layer and use Xavier initialization. For regularization we’ll use L1. Let’s see what’s inside the <code>LSTM</code> as printed by MXNet.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>print(lstm_model)</span><span><strong>output</strong> &gt;&gt;&gt;</span><span>RNNModel(<br/>   (rnn): LSTM(112 -&gt; 500, TNC)<br/>   (decoder): Dense(500 -&gt; 1, linear)<br/>)</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">As we can see, the input of the LSTM are the 112 features (<code>dataset_total_df.shape[1]</code>) which then go into 500 neurons in the LSTM layer, and then transformed to a single output - the stock price value.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">The logic behind the LSTM is: we take 17 (<code>sequence_length</code>) days of data (again, the data being the stock price for GS stock every day + all the other feature for that day - correlated assets, sentiment, etc.) and try to predict the 18th day. Then we move the 17 days window with one day and again predict the 18th. We iterate like this over the whole dataset (of course in batches).</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">In another post I will explore whether modification over the vanilla LSTM would be more beneficial, such as:</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;">using <strong>bidirectional</strong> LSTM layer — in theory, going backwards (from end of the data set towards the beginning) might somehow help the LSTM figure out the pattern of the stock movement.</li><li class="ff3" style="font-size:22px;">using <strong>stacked</strong> RNN architecture — having not only one LSTM layer but 2 or more. This, however, might be dangerous, as we might end up overfitting the model, as we don’t have a lot of data (we have just 1,585 day worth of data).</li><li class="ff3" style="font-size:22px;">Exploring <strong>GRU</strong> — as already explained, GRUs’ cells are much simpler.</li><li class="ff3" style="font-size:22px;">Adding <strong>attention</strong> vectors to the RNN.</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">3.4.3. Learning rate scheduler</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">One of the most important hyperparameters is the learning rate. Setting the learning rate for almost every optimizer (such as <strong>SGD</strong>, <strong>Adam</strong>, or <strong>RMSProp</strong>) is crucially important when training neural networks because it controls both the speed of convergence and the ultimate performance of the network. One of the simplest learning rate strategies is to have a fixed learning rate throughout the training process. Choosing a small learning rate allows the optimizer find good solutions, but this comes at the expense of limiting the initial speed of convergence. Changing the learning rate over time can overcome this tradeoff.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Recent papers, such as <a href="https://arxiv.org/pdf/1806.01593.pdf" target="_self">this</a> one, show the benefits of changing the global learning rate during training, in terms of both convergence and time. Let’s plot the learning rates we’ll be using for each epoch.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>schedule = CyclicalSchedule(TriangularSchedule, min_lr=0.5, max_lr=2, cycle_length=500)<br/>iterations=1500</span><span>plt.plot([i+1 for i in range(iterations)],[schedule(i) for i in range(iterations)])<br/>plt.title('Learning rate for each epoch')<br/>plt.xlabel("Epoch")<br/>plt.ylabel("Learning Rate")<br/>plt.show()</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:51%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 389px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*kY6bUOtF9AlyUBwei8Noug.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*kY6bUOtF9AlyUBwei8Noug.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*kY6bUOtF9AlyUBwei8Noug.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*kY6bUOtF9AlyUBwei8Noug.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*kY6bUOtF9AlyUBwei8Noug.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*kY6bUOtF9AlyUBwei8Noug.png 1100w, https://miro.medium.com/v2/resize:fit:778/format:webp/1*kY6bUOtF9AlyUBwei8Noug.png 778w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 389px" srcset="https://miro.medium.com/v2/resize:fit:640/1*kY6bUOtF9AlyUBwei8Noug.png 640w, https://miro.medium.com/v2/resize:fit:720/1*kY6bUOtF9AlyUBwei8Noug.png 720w, https://miro.medium.com/v2/resize:fit:750/1*kY6bUOtF9AlyUBwei8Noug.png 750w, https://miro.medium.com/v2/resize:fit:786/1*kY6bUOtF9AlyUBwei8Noug.png 786w, https://miro.medium.com/v2/resize:fit:828/1*kY6bUOtF9AlyUBwei8Noug.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*kY6bUOtF9AlyUBwei8Noug.png 1100w, https://miro.medium.com/v2/resize:fit:778/1*kY6bUOtF9AlyUBwei8Noug.png 778w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/389/1*kY6bUOtF9AlyUBwei8Noug.png"></picture></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">3.4.4. How to prevent overfitting and the bias-variance trade-off</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Having a lot of features and neural networks we need to make sure we prevent overfitting and be mindful of the total loss.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We use several techniques for preventing overfitting (not only in the LSTM, but also in the CNN and the auto-encoders):</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;"><strong>Ensuring data quality</strong>. We already performed statistical checks and made sure the data doesn’t suffer from multicollinearity or serial autocorrelation. Further we performed feature importance check on each feature. Finally, the initial feature selection (e.g. selecting correlated assets, technical indicators, etc.) was done with some domain knowledge about the mechanics behind the way stock markets work.</li><li class="ff3" style="font-size:22px;"><strong>Regularization</strong> (or weights penalty). The two most widely used regularization techniques are LASSO (<strong>L1</strong>) and Ridge (<strong>L2</strong>). L1 adds the mean absolute error and L2 adds mean squared error to the loss. Without going into too many mathematical details, the basic differences are: lasso regression (L1) does both variable selection and parameter shrinkage, whereas Ridge regression only does parameter shrinkage and end up including all the coefficients in the model. In presence of correlated variables, ridge regression might be the preferred choice. Also, ridge regression works best in situations where the least square estimates have higher variance. Therefore, it depends on our model objective. The impact of the two types of regularizations is quite different. While they both penalize large weights, L1 regularization leads to a non-differentiable function at zero. L2 regularization favors smaller weights, but L1 regularization favors weights that go to zero. So, with L1 regularization you can end up with a sparse model — one with fewer parameters. In both cases the parameters of the L1 and L2 regularized models “shrink”, but in the case of L1 regularization the shrinkage directly impacts the complexity (the number of parameters) of the model. Precisely, ridge regression works best in situations where the least square estimates have higher variance. L1 is more robust to outliers, is used when data is sparse, and creates feature importance. We will use L1.</li><li class="ff3" style="font-size:22px;"><strong>Dropout</strong>. Dropout layers randomly remove nodes in the hidden layers.</li><li class="ff3" style="font-size:22px;"><strong>Dense-sparse-dense training</strong>. — <a href="https://arxiv.org/pdf/1607.04381v1.pdf" target="_self">link</a></li><li class="ff3" style="font-size:22px;"><strong>Early stopping</strong>.</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Another important consideration when building complex neural networks is the bias-variance trade-off. Basically, the error we get when training nets is a function of the bias, the variance, and irreducible error — σ (error due to noise and randomness). The simplest formula of the trade-off is: Error=bias^2+variance+σ.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;"><strong>Bias</strong>. Bias measures how well a trained (on training dataset) algorithm can generalize on unseen data. High bias (underfitting) meaning the model cannot work well on unseen data.</li><li class="ff3" style="font-size:22px;"><strong>Variance</strong>. Variance measures the sensitivity of the model to changes in the dataset. High variance is the overfitting.</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">3.5. The Discriminator — One Dimentional CNN</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">4.5.1. Why CNN as a discriminator?</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We usually use CNNs for work related to images (classification, context extraction, etc). They are very powerful at extracting features from features from features, etc. For example, in an image of a dog, the first convolutional layer will detect edges, the second will start detecting circles, and the third will detect a nose. In our case, data points form small trends, small trends form bigger, trends in turn form patterns. CNNs’ ability to detect features can be used for extracting information about patterns in GS’s stock price movements.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Another reason for using CNN is that CNNs work well on spatial data — meaning data points that are closer to each other are more related to each other, than data points spread across. This should hold true for time series data. In our case each data point (for each feature) is for each consecutive day. It is natural to assume that the closer two days are to each other, the more related they are to each other. One thing to consider (although not covered in this work) is seasonality and how it might change (if at all) the work of the CNN.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note</strong>: As many other parts in this notebook, using CNN for time series data is experimental. We will inspect the results, without providing mathematical or other proofs. And results might vary using different data, activation functions, etc.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">3.5.1. The CNN Architecture</h4></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 1100w, https://miro.medium.com/v2/resize:fit:1400/1*My1hiYMJeYWIBbuUQJfqKg.jpeg 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*My1hiYMJeYWIBbuUQJfqKg.jpeg"></picture></div><p class="mbr-description mbr-fonts-style mt-2 align-center display-12 text-muted" style="font-size:12px;">The architecture of the proposed CNN model.</p><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Without going through the full code, we’ll just show the CNN as printed by MXNet.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>Sequential(<br/>   (0): Conv1D(None -&gt; 32, kernel_size=(5,), stride=(2,)) <br/>   (1): LeakyReLU(0.01) <br/>   (2): Conv1D(None -&gt; 64, kernel_size=(5,), stride=(2,)) <br/>   (3): LeakyReLU(0.01) <br/>   (4): BatchNorm(axis=1, eps=1e-05, momentum=0.9, fix_gamma=False, use_global_stats=False, in_channels=None) <br/>   (5): Conv1D(None -&gt; 128, kernel_size=(5,), stride=(2,)) <br/>   (6): LeakyReLU(0.01) <br/>   (7): BatchNorm(axis=1, eps=1e-05, momentum=0.9, fix_gamma=False, use_global_stats=False, in_channels=None) <br/>   (8): Dense(None -&gt; 220, linear) <br/>   (9): BatchNorm(axis=1, eps=1e-05, momentum=0.9, fix_gamma=False, use_global_stats=False, in_channels=None) <br/>   (10): LeakyReLU(0.01) <br/>   (11): Dense(None -&gt; 220, linear) <br/>   (12): Activation(relu) <br/>   (13): Dense(None -&gt; 1, linear) <br/>)</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">3.6. Hyperparameters</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">The hyperparameters that we will track and optimize are:</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;"><code>batch_size</code> : batch size of the LSTM and CNN</li><li class="ff3" style="font-size:22px;"><code>cnn_lr</code>: the learningrate of the CNN</li><li class="ff3" style="font-size:22px;"><code>strides</code>: the number of strides in the CNN</li><li class="ff3" style="font-size:22px;"><code>lrelu_alpha</code>: the alpha for the LeakyReLU in the GAN</li><li class="ff3" style="font-size:22px;"><code>batchnorm_momentum</code>: momentum for the batch normalisation in the CNN</li><li class="ff3" style="font-size:22px;"><code>padding</code>: the padding in the CNN</li><li class="ff3" style="font-size:22px;"><code>kernel_size':1</code>: kernel size in the CNN</li><li class="ff3" style="font-size:22px;"><code>dropout</code>: dropout in the LSTM</li><li class="ff3" style="font-size:22px;"><code>filters</code>: the initial number of filters</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">We will train over 200 <code>epochs</code>.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
            <br>
                <hr class="hr5">
            <br>
            </div>
        </div>
    </div>
</section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">4. Hyperparameters optimisation</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">After the GAN trains on the 200 epochs it will record the MAE (which is the error function in the LSTM, the GG) and pass it as a reward value to the Reinforcement learning that will decide whether to change the hyperparameters of keep training with the same set of hyperparameters. As described later, this approach is strictly for experimenting with RL.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">If the RL decides it will update the hyperparameters it will call Bayesian optimisation (discussed below) library that will give the next best expected set of the hyperparams</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">4.1. Reinforcement learning for hyperparameters optimization</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Why do we use reinforcement learning in the hyperparameters optimization? Stock markets change all the time. Even if we manage to train our GAN and LSTM to create extremely accurate results, the results might only be valid for a certain period. Meaning, we need to constantly optimise the whole process. To optimize the process we can:</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;">Add or remove features (e.g. add new stocks or currencies that might be correlated)</li><li class="ff3" style="font-size:22px;">Improve our deep learning models. One of the most important ways to improve the models is through the hyper parameters (listed in Section 5). Once having found a certain set of hyperparameters we need to decide when to change them and when to use the already known set (exploration vs. exploitation). Also, stock market represents a continuous space that depends on millions parameters.</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note</strong>: The purpose of the whole reinforcement learning part of this notebook is more research oriented. We will explore different RL approaches using the GAN as an environment. There are many ways in which we can successfully perform hyperparameter optimization on our deep learning models without using RL. But… why not.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note</strong>: The next several sections assume you have some knowledge about RL — especially policy methods and Q-learning.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">4.1.1. Reinforcement Learning Theory</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Without explaining the basics of RL we will jump into the details of the specific approaches we implement here. We will use model-free RL algorithms for the obvious reason that we do not know the whole environment, hence there is no defined model for how the environment works — if there was we wouldn’t need to predict stock prices movements — they will just follow the model. We will use the two subdivisions of model-free RL — Policy optimization and Q-learning.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;"><strong>Q-learning</strong> — in Q-learning we learn the <strong>value</strong> of taking an action from a given state. <strong>Q-value</strong> is the expected return after taking the action. We will use <strong>Rainbow</strong> which is a combination of seven Q learning algorithms.</li><li class="ff3" style="font-size:22px;"><strong>Policy Optimization</strong> — in policy optimization we learn the action to take from a given state. (if we use methods like Actor/Critic) we also learn the value of being in a given state. We will use <strong>Proximal Policy Optimization</strong>.</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">One crucial aspect of building a RL algorithm is accurately setting the reward. It has to capture all aspects of the environment and the agent’s interaction with the environment. We define the reward, <strong>R</strong>, as:</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Reward=2∗lossG+lossD+accuracyG,</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">where lossG, accuracyG, and lossD are the Generator’s loss and accuracy, and Discriminator’s loss, respectively. The environment is the <strong>GAN</strong> and the results of the <strong>LSTM</strong> training. The action the different agents can take is how to change the hyperparameters of the GAN’s D and G nets.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">4.1.1.1. Rainbow</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>What is Rainbow?</strong></p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Rainbow</strong> (<a href="https://arxiv.org/pdf/1710.02298.pdf" target="_self">link</a>) is a Q learning based off-policy deep reinforcement learning algorithm combining seven algorithm together:</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;"><strong>DQN</strong>. DQN is an extension of Q learning algorithm that uses a neural network to represent the Q value. Similar to supervised (deep) learning, in DQN we train a neural network and try to minimize a loss function. We train the network by randomly sampling transitions (state, action, reward). The layers can be not only fully connected ones, but also convolutional, for example.</li><li class="ff3" style="font-size:22px;"><strong>Double Q Learning</strong>. Double QL handles a big problem in Q learning, namely the overestimation bias.</li><li class="ff3" style="font-size:22px;"><strong>Prioritized replay</strong>. In the vanilla DQN, all transitions are stored in a replay buffer and it uniformly samples this buffer. However, not all transitions are equally beneficial during the learning phase (which also makes learning inefficient as more episodes are required). Prioritized experience replay doesn’t sample uniformly, rather it uses a distribution that gives higher probability to samples that have had higher Q loss in previous iterations.</li><li class="ff3" style="font-size:22px;"><strong>Dueling networks.</strong> Dueling networks change the Q learning architecture a little by using two separate streams (i.e. having two different mini-neural networks). One stream is for the value and one for the <em>advantage</em>. Both of them share a convolutional encoder. The tricky part is the merging of the streams — it uses a special aggregator (<em>Wang et al. 2016</em>).</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><em>(Advantage</em>, formula is A(s,a)=Q(s,a)−V(s), generally speaking is a comparison of how good an action is compared to the average action for a specific state. Advantages are sometimes used when a ‘wrong’ action cannot be penalized with negative reward. So <em>advantage </em>will try to further reward good actions from the average actions.)</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;"><strong>Multi-step learning.</strong> The big difference behind Multi-step learning is that it calculates the Q-values using N-step returns (not only the return from the next step), which naturally should be more accurate.</li><li class="ff3" style="font-size:22px;"><strong>Distributional RL</strong>. Q learning uses average estimated Q-value as target value. However, in many cases the Q-values might not be the same in different situations. Distributional RL can directly learn (or approximate) the distribution of Q-values rather than averaging them. Again, the math is much more complicated than that, but for us the benefit is more accurate sampling of the Q-values.</li><li class="ff3" style="font-size:22px;"><strong>Noisy Nets</strong>. Basic DQN implements a simple 𝜀-greedy mechanism to do exploration. This approach to exploration inefficient at times. The way Noisy Nets approach this issue is by adding a noisy linear layer. Over time, the network will learn how to ignore the noise (added as a noisy stream). But this learning comes at different rates in different parts of the space, allowing for state exploration.</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note: Stay tuned — I will upload a MXNet/Gluon implementation on Rainbow to Github in early February 2019.</strong></p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">4.1.1.2. PPO</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Proximal Policy Optimization</strong> (<a href="https://arxiv.org/pdf/1707.06347.pdf" target="_self">PPO</a>) is a policy optimization model-free type of reinforcement learning. It is much simpler to implement that other algorithms and gives very good results.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Why do we use PPO? One of the advantages of PPO is that it directly learns the policy, rather than indirectly via the values (the way Q Learning uses Q-values to learn the policy). It can work well in continuous action spaces, which is suitable in our use case and can learn (through mean and standard deviation) the distribution probabilities (if softmax is added as an output).</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">The problem of policy gradient methods is that they are extremely sensitive to the step size choice — if it is small the progress takes too long (most probably mainly due to the need of a second-order derivatives matrix); if it is large, there is a lot noise which significantly reduces the performance. Input data is nonstationary due to the changes in the policy (also the distributions of the reward and observations change). As compared to supervised learning, poorly chosen step can be much more devastating as it affects the whole distribution of next visits. PPO can solve these issues. What is more, compared to some other approaches, PPO:</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;">is much less complicated, for example compared to <strong>ACER</strong>, which requires additional code for keeping the off-policy correlations and also a replay buffer, or <strong>TRPO</strong> which has a constraint imposed on the surrogate objective function (the KL divergence between the old and the new policy). This constraint is used to control the policy of changing too much — which might create instability. PPO reduces the computation (created by the constraint) by utilizing a <em>clipped (between [1- 𝜖, 1+𝜖]) surrogate objective function</em> and modifying the objective function with a penalty for having too big of an update.</li><li class="ff3" style="font-size:22px;">gives compatibility with algos that share parameters between value and policy function or auxiliary losses, as compared to TRPO (although PPO also have the gain of trust region PO).</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>Note</strong>: For the purpose of our exercise we won’t go too much into the research and optimization of RL approaches, PPO and the others included. Rather, we will take what is available and try to fit into our process for hyperparameter optimization for our <strong>GAN</strong>, <strong>LSTM</strong>, and <strong>CNN</strong> models. The code we will reuse and customize is created by OpenAI and is available <a href="https://github.com/openai/baselines" target="_self">here</a>.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">4.1.2. Further work on Reinforcement learning</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Some ideas for further exploring reinforcement learning:</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;">One of the first things I will introduce next is using <strong>Augmented Random Search</strong> (<a href="https://arxiv.org/pdf/1803.07055.pdf" target="_self">link</a>) as an alternative algorithm. The authors of the algorithm (out of UC, Berkeley) have managed to achieve similar rewards results as other state of the art approaches, such as PPO, but on average 15 times faster.</li><li class="ff3" style="font-size:22px;">Choosing a reward function is very important. I stated the currently used reward function above, but I will try to play with different functions as an alternative.</li><li class="ff3" style="font-size:22px;">Using <strong>Curiosity</strong> as an exploration policy.</li><li class="ff3" style="font-size:22px;">Create <strong>multi-agent</strong> architecture as proposed by Berkeley’s AI Research team (BAIR) — <a href="https://bair.berkeley.edu/blog/2018/12/12/rllib/" target="_self">link</a>.</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">4.2. Bayesian optimization</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Instead of the grid search, that can take a lot of time to find the best combination of hyperparameters, we will use <strong>Bayesian optimization</strong>. The library that we’ll use is already implemented — <a href="https://github.com/fmfn/BayesianOptimization" target="_self">link</a>.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">4.2.1. Gaussian process</h4></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*JCO5-noInHvLHeZaqU5Saw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*JCO5-noInHvLHeZaqU5Saw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*JCO5-noInHvLHeZaqU5Saw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*JCO5-noInHvLHeZaqU5Saw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*JCO5-noInHvLHeZaqU5Saw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JCO5-noInHvLHeZaqU5Saw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JCO5-noInHvLHeZaqU5Saw.png 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*JCO5-noInHvLHeZaqU5Saw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*JCO5-noInHvLHeZaqU5Saw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*JCO5-noInHvLHeZaqU5Saw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*JCO5-noInHvLHeZaqU5Saw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*JCO5-noInHvLHeZaqU5Saw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*JCO5-noInHvLHeZaqU5Saw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*JCO5-noInHvLHeZaqU5Saw.png 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*JCO5-noInHvLHeZaqU5Saw.png"></picture></div><p class="mbr-description mbr-fonts-style mt-2 align-center display-12 text-muted" style="font-size:12px;">Gaussian process for Bayesian hyperparameter optimisation</p><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
            <br>
                <hr class="hr5">
            <br>
            </div>
        </div>
    </div>
</section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">5. The Result</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Finally we will compare the output of the LSTM when the unseen (test) data is used as an input after different phases of the process.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ol><li class="ff3" style="font-size:22px;">Plot after the first epoch.</li></ol></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>from utils import plot_prediction</span><span>plot_prediction('Predicted and Real price - after first epoch.')</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*uKkExoSy4o6zo3dwfPoPwg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*uKkExoSy4o6zo3dwfPoPwg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*uKkExoSy4o6zo3dwfPoPwg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*uKkExoSy4o6zo3dwfPoPwg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*uKkExoSy4o6zo3dwfPoPwg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*uKkExoSy4o6zo3dwfPoPwg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uKkExoSy4o6zo3dwfPoPwg.png 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*uKkExoSy4o6zo3dwfPoPwg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*uKkExoSy4o6zo3dwfPoPwg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*uKkExoSy4o6zo3dwfPoPwg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*uKkExoSy4o6zo3dwfPoPwg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*uKkExoSy4o6zo3dwfPoPwg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*uKkExoSy4o6zo3dwfPoPwg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*uKkExoSy4o6zo3dwfPoPwg.png 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*uKkExoSy4o6zo3dwfPoPwg.png"></picture></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">2. Plot after 50 epochs.</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>plot_prediction('Predicted and Real price - after first 50 epochs.')</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*cqfAntAtxKMw-eo8s1b3MA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*cqfAntAtxKMw-eo8s1b3MA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*cqfAntAtxKMw-eo8s1b3MA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*cqfAntAtxKMw-eo8s1b3MA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*cqfAntAtxKMw-eo8s1b3MA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*cqfAntAtxKMw-eo8s1b3MA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cqfAntAtxKMw-eo8s1b3MA.png 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*cqfAntAtxKMw-eo8s1b3MA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*cqfAntAtxKMw-eo8s1b3MA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*cqfAntAtxKMw-eo8s1b3MA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*cqfAntAtxKMw-eo8s1b3MA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*cqfAntAtxKMw-eo8s1b3MA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*cqfAntAtxKMw-eo8s1b3MA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*cqfAntAtxKMw-eo8s1b3MA.png 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*cqfAntAtxKMw-eo8s1b3MA.png"></picture></div><br></div></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>plot_prediction('Predicted and Real price - after first 200 epochs.')</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*-VuHm3t1eGQMziCU7xjcVA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*-VuHm3t1eGQMziCU7xjcVA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*-VuHm3t1eGQMziCU7xjcVA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*-VuHm3t1eGQMziCU7xjcVA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*-VuHm3t1eGQMziCU7xjcVA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*-VuHm3t1eGQMziCU7xjcVA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-VuHm3t1eGQMziCU7xjcVA.png 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*-VuHm3t1eGQMziCU7xjcVA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*-VuHm3t1eGQMziCU7xjcVA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*-VuHm3t1eGQMziCU7xjcVA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*-VuHm3t1eGQMziCU7xjcVA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*-VuHm3t1eGQMziCU7xjcVA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*-VuHm3t1eGQMziCU7xjcVA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*-VuHm3t1eGQMziCU7xjcVA.png 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*-VuHm3t1eGQMziCU7xjcVA.png"></picture></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">The RL run for ten episodes (we define an eposide to be one full GAN training on the 200 epochs.)</p></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="iframe"><pre><span>plot_prediction('Final result.')</span></pre></div><br></div></div></div></div></section><section data-bs-version="5.1" class="image3 cid-tt612oXwA9" id="image3-5" style="padding-top:0px; padding-bottom:0px; background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-9">
                <div class="image-wrapper"><div class="image_style" style="width:96%;"><picture><source sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*FeWF_24neEhH9Gpra1DGmA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*FeWF_24neEhH9Gpra1DGmA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*FeWF_24neEhH9Gpra1DGmA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*FeWF_24neEhH9Gpra1DGmA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*FeWF_24neEhH9Gpra1DGmA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*FeWF_24neEhH9Gpra1DGmA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FeWF_24neEhH9Gpra1DGmA.png 1400w" type="image/webp"/><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/v2/resize:fit:640/1*FeWF_24neEhH9Gpra1DGmA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*FeWF_24neEhH9Gpra1DGmA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*FeWF_24neEhH9Gpra1DGmA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*FeWF_24neEhH9Gpra1DGmA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*FeWF_24neEhH9Gpra1DGmA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*FeWF_24neEhH9Gpra1DGmA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*FeWF_24neEhH9Gpra1DGmA.png 1400w"/><img alt="" loading="lazy" role="presentation" src="https://miro.medium.com/max/700/1*FeWF_24neEhH9Gpra1DGmA.png"></picture></div><br></div></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">As a next step, I will try to take everything separately and provide some analysis on what worked and why. Why did we receive these results and is it just by coinscidence? So stay tuned.</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
            <br>
                <hr class="hr5">
            <br>
            </div>
        </div>
    </div>
</section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">6. What is next?</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><ul><li class="ff3" style="font-size:22px;">Next, I will try to create a RL environment for testing trading algorithms that decide when and how to trade. The output from the GAN will be one of the parameters in the environment.</li></ul></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
            <br>
                <hr class="hr5">
            <br>
            </div>
        </div>
    </div>
</section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">7. Disclaimer</h4></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>This notebook is entirely informative. None of the content presented in this notebook constitutes a recommendation that any particular security, portfolio of securities, transaction or investment strategy is suitable for any specific person. Futures, stocks and options trading involves substantial risk of loss and is not suitable for every investor. The valuation of futures, stocks and options may fluctuate, and, as a result, clients may lose more than their original investment.</strong></p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;"><strong>All trading strategies are used at your own risk.</strong></p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">There are many many more details to explore — in choosing data features, in choosing algorithms, in tuning the algos, etc. This version of the notebook itself took me 2 weeks to finish. I am sure there are many unaswered parts of the process. So, any comments and suggestion — please do share. I’d be happy to add and test any ideas in the current process.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Thanks for reading.</p></div></div></div></section><section data-bs-version="5.1" class="content5 cid-tt5UseJ9wk" id="content5-4" style="padding-top:0px; padding-bottom:0px;background-color: rgb(255, 255, 255);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-9"><p class="ff3" style="font-size:22px;">Best, Boris</p></div></div></div></section><?php include_once 'Elemental/footer.php'; ?>